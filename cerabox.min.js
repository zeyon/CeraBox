/*! cerabox 2015-06-19 */
!function(window){"use strict";window.CeraBox=new Class({version:"1.3.8",Implements:[Options],boxWindow:null,collection:[],currentItem:0,options:{ajax:null,swf:null,group:!0,width:null,height:null,displayTitle:!0,forceTitle:!1,fullSize:!1,displayOverlay:!0,clickToClose:!1,loaderAtItem:!1,animation:"fade",errorLoadingMessage:"The requested content cannot be loaded or might not be supported. Please try again later.",titleFormat:"Item {number} / {total} {title}",addContentProtectionLayer:!1,mobileView:["ios","android","webos"].contains(Browser.platform),fixedPosition:!1,clickToCloseOverlay:!0,constrainProportions:!1,devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,preventScrolling:!1,events:{onOpen:function(a,b){},onChange:function(a,b){},onClose:function(a,b){},onAnimationEnd:function(a,b){}}},initialize:function(a,b){this.boxWindow=CeraBoxWindow,a=$$(a),b&&"null"!=typeOf(b.group)&&b.group===!1&&a.length>1&&a.each(function(a){a.store("cerabox",new CeraBox(a,b))}),this.setOptions(b),a.each(function(a,b){this.collection[b]=a;var c=a.dataset?"string"==typeOf(a.dataset.type)&&""!=a.dataset.type.trim()?a.dataset.type.trim():null:a.get("data-type")&&""!=a.get("data-type").trim()?a.get("data-type").trim():null;if(null!==this.options.ajax&&null===c||"ajax"==c)a.addEvent("click",function(a){return this._itemClick(a)?(this.currentItem=b,this.showAjax(),!0):!1}.bind(this));else if(a.get("href").test(/^#/i)&&null===c||"inline"==c)a.addEvent("click",function(a){return this._itemClick(a)?(this.currentItem=b,this.showInline(),!0):!1}.bind(this));else if(a.get("href").test(/\.(jpg|jpeg|png|gif|bmp)(.*)?$/i)&&null===c||"image"==c)a.addEvent("click",function(a){return this._itemClick(a)?(this.currentItem=b,this.showImage(),!0):!1}.bind(this));else if(a.get("href").test(/\.(swf)(.*)?$/i)&&null===c||"swf"==c)a.addEvent("click",function(a){return this._itemClick(a)?(this.currentItem=b,this.showSwf(),!0):!1}.bind(this));else{if(null!==c&&"iframe"!=c)throw"Unknown type in dataset: "+c;a.addEvent("click",function(a){return this._itemClick(a)?(this.currentItem=b,this.showIframe(),!0):!1}.bind(this))}}.bind(this))},showAjax:function(){var ceraBox=this,currentItem=ceraBox.collection[ceraBox.currentItem],requestEr=new Request.HTML(Object.merge({url:currentItem.get("href"),method:"post",data:"",evalScripts:!1,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){if(!1!==ceraBox.boxWindow.getBusy()){var assets=[];Array.each(responseElements,function(a){"img"==a.get("tag")&&a.get("src")&&assets.append([a.get("src")])});var assetsLoaded=function(){var ajaxEle=ceraBox.boxWindow.preLoadElement(responseTree);!0!==ceraBox.options.constrainProportions||ceraBox.options.width&&ceraBox.options.height||!ceraBox.options.width&&!ceraBox.options.height?(ajaxEle.setStyle("width",ceraBox.options.width?ceraBox.options.width:ajaxEle.getScrollSize().x),ajaxEle.setStyle("height",ceraBox.options.height?ceraBox.options.height:ajaxEle.getScrollSize().y)):ceraBox.options.width?(ajaxEle.set("height",Math.round(ajaxEle.getScrollSize().y*(ceraBox.boxWindow.sizeStringToInt(ceraBox.options.width,"x")/ajaxEle.getScrollSize().x))),ajaxEle.set("width",ceraBox.options.width)):(ajaxEle.set("width",Math.round(ajaxEle.getScrollSize().x*(ceraBox.boxWindow.sizeStringToInt(ceraBox.options.height,"y")/ajaxEle.getScrollSize().y))),ajaxEle.set("height",ceraBox.options.height));var dimension=ceraBox.boxWindow.getSizeElement(ajaxEle);ajaxEle=ajaxEle.get("html"),ceraBox.boxWindow.onLoad(dimension.width,dimension.height).addEvent("complete",function(){this.removeEvents("complete"),!1!==ceraBox.boxWindow.getBusy()&&(!1!==ceraBox.options.displayTitle&&ceraBox.boxWindow.displayTitle(currentItem.get("title")?currentItem.get("title"):"",ceraBox.currentItem+1,ceraBox.collection.length),ceraBox.boxWindow.setContent(new Element("div",{html:ajaxEle})).openWindow(),function(){eval(responseJavaScript)}.call(ceraBox))})};assets.length?Asset.images(assets,{onComplete:assetsLoaded}):assetsLoaded()}},onerror:ceraBox._timedOut.bind(ceraBox),onTimeout:ceraBox._timedOut.bind(ceraBox),onFailure:ceraBox._timedOut.bind(ceraBox),onException:ceraBox._timedOut.bind(ceraBox)},"object"===typeOf(ceraBox.options.ajax)?ceraBox.options.ajax:{})).send()},showInline:function(){var a=this,b=a.collection[a.currentItem],c=b.get("href").test(/^#\$/i)&&"null"!=typeOf(window[b.get("href").replace(/^#\$/i,"")])?"element"!=typeOf(window[b.get("href").replace(/^#\$/i,"")])?new Element("div",{html:window[b.get("href").replace(/^#\$/i,"")]}):window[b.get("href").replace(/^#\$/i,"")]:document.id(document.body).getElement(b.get("href"))?document.id(document.body).getElement(b.get("href")).clone():null;if(null!==c){var d=[];Array.each(c.getElements("img"),function(a){a.get("src")&&d.append([a.get("src")])});var e=function(){var d=a.boxWindow.preLoadElement(c.clone());!0!==a.options.constrainProportions||a.options.width&&a.options.height||!a.options.width&&!a.options.height?(d.setStyle("width",a.options.width?a.options.width:d.getScrollSize().x),d.setStyle("height",a.options.height?a.options.height:d.getSize().y)):a.options.width?(d.set("height",Math.round(d.getSize().y*(a.boxWindow.sizeStringToInt(a.options.width,"x")/d.getScrollSize().x))),d.set("width",a.options.width)):(d.set("width",Math.round(d.getScrollSize().x*(a.boxWindow.sizeStringToInt(a.options.height,"y")/d.getSize().y))),d.set("height",a.options.height));var e=a.boxWindow.getSizeElement(d);a.boxWindow.onLoad(e.width,e.height).addEvent("complete",function(){this.removeEvents("complete"),!1!==a.boxWindow.getBusy()&&(!1!==a.options.displayTitle&&a.boxWindow.displayTitle(b.get("title")?b.get("title"):"",a.currentItem+1,a.collection.length),a.boxWindow.setContent(c).openWindow())})};d.length?Asset.images(d,{onComplete:e}):e()}else a._timedOut()},showImage:function(){var a=this,b=a.collection[a.currentItem],c=new Asset.image(b.get("href"),{"class":"ceraImage",onload:function(){if(!1!==a.boxWindow.getBusy()){!0!==a.options.constrainProportions||a.options.width&&a.options.height||!a.options.width&&!a.options.height?(this.set("width",a.options.width?a.options.width:this.get("width")),this.set("height",a.options.height?a.options.height:this.get("height"))):a.options.width?(this.set("height",Math.round(this.get("height").toInt()*(a.boxWindow.sizeStringToInt(a.options.width,"x")/this.get("width")))),this.set("width",a.options.width)):(this.set("width",Math.round(this.get("width").toInt()*(a.boxWindow.sizeStringToInt(a.options.height,"y")/this.get("height")))),this.set("height",a.options.height));var d=a.boxWindow.getSizeElement(this);a.options.devicePixelRatio>1&&(d={width:d.width/a.options.devicePixelRatio,height:d.height/a.options.devicePixelRatio}),a.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete"),!1!==a.boxWindow.getBusy()&&(!1!==a.options.displayTitle&&a.boxWindow.displayTitle(b.get("title")?b.get("title"):"",a.currentItem+1,a.collection.length),a.boxWindow.setContent(c).openWindow())})}},onerror:a._timedOut.bind(a)})},showSwf:function(){if(0==Browser.Plugins.Flash.version)return void this._timedOut();var a=this,b=a.collection[a.currentItem],c={width:a.options.width?a.options.width:500,height:a.options.height?a.options.height:400},d=new Swiff(b.get("href"),Object.merge({width:c.width,height:c.height,params:{wMode:"opaque",base:/(.*)\/.+(\.swf).*/.exec(b.get("href"))[1]}},"object"===typeOf(a.options.swf)?a.options.swf:{}));a.boxWindow.onLoad(c.width,c.height).addEvent("complete",function(){this.removeEvents("complete"),!1!==a.boxWindow.getBusy()&&(!1!==a.options.displayTitle&&a.boxWindow.displayTitle(b.get("title")?b.get("title"):"",a.currentItem+1,a.collection.length),a.boxWindow.setContent(d).openWindow())})},showIframe:function(){this.boxWindow.setTimeOuter(this._timedOut.delay(1e4,this));var a=this,b=a.collection[a.currentItem],c=new IFrame({src:b.get("href"),"class":"ceraIframe",styles:{width:1,height:1,border:"0px"},events:{load:function(){if(!1!==a.boxWindow.getBusy()||a.boxWindow.getWindowOpen()){if(!a.options.width&&!a.options.height)try{!Browser.ie||Browser.version>8?this.contentWindow.onbeforeunload=function(){a.boxWindow.loading(a),this.setStyles({width:"1px",height:"1px"})}.bind(this):this.setStyles({width:"1px",height:"1px"})}catch(c){}a.options.width&&this.setStyle("width",a.options.width),a.options.height&&this.setStyle("height",a.options.height);var d=a.boxWindow.getSizeElement(this);a.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete"),(!1!==a.boxWindow.getBusy()||a.boxWindow.getWindowOpen())&&(!1!==a.options.displayTitle&&a.boxWindow.displayTitle(b.get("title")?b.get("title"):"",a.currentItem+1,a.collection.length),a.boxWindow.openWindow())})}}}});c.set("border",0),c.set("frameborder",0),this.boxWindow.setContent(c)},_timedOut:function(){var a=this,b=new Element("span",{"class":"cerabox-error",html:a.options.errorLoadingMessage}),c=a.boxWindow.preLoadElement(b.clone());c.setStyle("width","270px"),c.setStyle("height",c.getSize().y+"px"),this.options.mobileView&&b.setStyles({position:"absolute",top:"50%","margin-top":-Math.round(c.getSize().y/2)+"px"});var d=a.boxWindow.getSizeElement(c,!0);a.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete"),!1!==a.boxWindow.getBusy()&&(a.boxWindow.hideTitle(),a.boxWindow.setContent(b).openWindow())})},_itemClick:function(a){return a&&a.preventDefault(),this.boxWindow.getBusy()?!1:(this.boxWindow.loading(this),!0)},_log:function(a,b){try{console.log(a)}catch(c){b&&alert(a)}}}),window.CeraBoxWindow=function(a){function b(){E.getElement(".cerabox-left").removeEvents("click").setStyle("display","none"),E.getElement(".cerabox-right").removeEvents("click").setStyle("display","none"),y.collection[y.currentItem-1]&&E.getElement(".cerabox-left").setStyle("display","block").addEvent("click",function(a){a.stopPropagation(),t||(this.setStyle("display","none").removeEvents("click"),y.collection[y.currentItem-1].fireEvent("click",a))}),y.collection[y.currentItem+1]&&E.getElement(".cerabox-right").setStyle("display","block").addEvent("click",function(a){a.stopPropagation(),t||(this.setStyle("display","none").removeEvents("click"),y.collection[y.currentItem+1].fireEvent("click",a))})}function c(b,c){if(b=b||z.x,c=c||z.y,y.options.forceTitle||y.options.displayTitle&&!E.getElement(".cerabox-content iframe.ceraIframe")||G.hideTitle(),y.options.mobileView){document.id(document.body).setStyle("overflow","hidden");var d,e,f,g,h=90==Math.abs(a.orientation),i=h?screen.height:screen.width;return E.getElement(".cerabox-content iframe.ceraIframe")?(d=D.x,e=D.y,f=c*d/b>e?e/c:d/b,g=1,E.getElements(".cerabox-close, .cerabox-left, .cerabox-right, .cerabox-title").setStyles({"-webkit-transform":"scale("+D.x/i+")",transform:"scale("+D.x/i+")"})):(E.getElement(".cerabox-content img.ceraImage")||(b=Math.round(D.x*(i/D.x)),c=Math.round(D.y*(i/D.x))),d=Math.round(D.x*(i/D.x)),e=Math.round(D.y*(i/D.x)),f=c*d/b>e?e/c:d/b,g=D.x/i,E.getElements(".cerabox-close, .cerabox-left, .cerabox-right, .cerabox-title").setStyles({"-webkit-transform":"scale(1)",transform:"scale(1)"})),E.setStyles({position:"absolute",display:"block",width:d+"px",height:e+"px",opacity:1,left:document.id(document.body).getScroll().x,right:0,top:document.id(document.body).getScroll().y,bottom:0,margin:0,"-webkit-transform":"scale("+g+")",transform:"scale("+g+")"}),E.getElement(".cerabox-content").setStyles({width:Math.round(b*f),height:Math.round(c*f),left:(d-Math.round(b*f))/2,top:(e-Math.round(c*f))/2}),E.getElement(".cerabox-content iframe.ceraIframe")&&E.getElement(".cerabox-content iframe.ceraIframe").setStyles({width:Math.round(b*f),height:Math.round(c*f)}),E.set("tween",{duration:0}).tween("opacity",1).get("tween")}E.getElement(".cerabox-content iframe.ceraIframe")&&E.getElement(".cerabox-content iframe.ceraIframe").setStyles({width:b,height:c});var j={display:"block",width:b,height:c,opacity:1,"-webkit-transform":"scale(1)",transform:"scale(1)"};if(E.setStyles({position:y.options.fixedPosition?"fixed":"absolute",top:Math.round(D.y/2)+"px",left:Math.round(D.x/2)+"px",right:"auto",bottom:"auto"}),D.x>b+60?j["margin-left"]=Math.round(-b/2+(y.options.fixedPosition?0:document.id(document.body).getScroll().x))+"px":j["margin-left"]=Math.round(D.x/2-b-40+(y.options.fixedPosition?0:document.id(document.body).getScroll().x))+"px",D.y>c+40?j["margin-top"]=Math.round(-c/2+(y.options.fixedPosition?0:document.id(document.body).getScroll().y))+"px":j["margin-top"]=Math.round(-D.y/2+20+(y.options.fixedPosition?0:document.id(document.body).getScroll().y))+"px",E.getElement(".cerabox-content").setStyles({width:"100%",height:"100%",left:0,top:0}),x)return E.set("morph",{duration:150}).morph(j).get("morph");switch(y.options.animation){case"ease":var k=y.collection[y.currentItem];return Object.append(j,{top:E.getStyle("top"),left:E.getStyle("left")}),E.setStyles({display:"block",left:k.getPosition().x-(y.options.fixedPosition?document.id(document.body).getScroll().x:0)+"px",top:k.getPosition().y-(y.options.fixedPosition?document.id(document.body).getScroll().y:0)+"px",width:k.getSize().x+"px",height:k.getSize().y+"px",margin:0,opacity:0}).set("morph",{duration:200}).morph(j).get("morph");case"fade":default:return Object.append(j,{opacity:0}),E.setStyles(j).set("tween",{duration:200}).tween("opacity",1).get("tween")}}function d(){var a={display:"block",opacity:y.options.mobileView?1:.5,top:0,left:0,height:"100%",width:"100%",position:"fixed"};y.options.mobileView&&Object.merge(a,{top:0,left:0,width:document.id(document.body).getScrollSize().x+"px",height:document.id(document.body).getScrollSize().y+"px",position:"absolute"}),document.id("cerabox-background").setStyles(a)}function e(){var b={position:"fixed",display:"block",top:"50%",left:"50%","margin-top":"-20px","margin-left":"-20px","-webkit-transform":"scale(1)",transform:"scale(1)"};if(!0!==y.options.loaderAtItem||x){if(y.options.mobileView){var c=90==Math.abs(a.orientation),d=c?screen.height:screen.width;Object.append(b,{position:"absolute",top:Math.round(D.y/2-document.id("cerabox-loading").getStyle("height").toInt()/2+document.id(document.body).getScroll().y)+"px",left:Math.round(D.x/2-document.id("cerabox-loading").getStyle("width").toInt()/2+document.id(document.body).getScroll().x)+"px","margin-top":0,"margin-left":0,"-webkit-transform":"scale("+D.x/d+")",transform:"scale("+D.x/d+")"})}}else{var e=y.collection[y.currentItem];Object.append(b,{position:"absolute",top:Math.round(e.getSize().y/2-document.id("cerabox-loading").getStyle("height").toInt()/2+e.getPosition().y)+"px",left:Math.round(e.getSize().x/2-document.id("cerabox-loading").getStyle("width").toInt()/2+e.getPosition().x)+"px","margin-top":0,"margin-left":0})}document.id("cerabox-loading").setStyles(b),f()}function f(a){a||(a=0),document.id("cerabox-loading").getElement("div").setStyle("top",-40*a+"px"),a=(a+1)%12,"none"!=document.id("cerabox-loading").getStyle("display")&&f.delay(60,this,a)}function g(a,b){return"string"==typeOf(a)&&a.test("%")?D[b]*(a.toInt()/100):a.toInt()}function h(){var a=document.id(document.body);a.getElement("#cerabox")||a.adopt([new Element("div",{id:"cerabox-loading"}).adopt(new Element("div")),new Element("div",{id:"cerabox-background",events:{click:function(a){a.stop(),y.options.clickToCloseOverlay&&G.close()}}}),E=new Element("div",{id:"cerabox"}).adopt([new Element("div",{"class":"cerabox-content"}),new Element("div",{"class":"cerabox-title"}).adopt(new Element("span")),new Element("a",{"class":"cerabox-close",events:{click:function(a){a.stop(),G.close()}}}),new Element("a",{"class":"cerabox-left"}).adopt(new Element("span")),new Element("a",{"class":"cerabox-right"}).adopt(new Element("span")),new Element("div",{"class":"cerabox-content-protection"}),new Element("div",{id:"cerabox-ajaxPreLoader",styles:{"float":"left",overflow:"hidden",display:"block"}})])])}function i(){clearInterval(A),E.getElements(".cerabox-title, .cerabox-close, .cerabox-left, .cerabox-right").set("tween",{duration:500}).tween("opacity",0)}function j(){E.getElements(".cerabox-title, .cerabox-close, .cerabox-left, .cerabox-right").setStyle("opacity",1),clearInterval(A),y.options.mobileView&&!y.options.clickToClose&&"createTouch"in document&&!E.getElement(".cerabox-content iframe.ceraIframe")&&(A=i.delay(5e3))}function k(a){B=C=a.client}function l(a){C=a.client,a.preventDefault()}function m(b){if(null!==B.x&&null!==C.x){var c=o(),d=90==Math.abs(a.orientation),e=d?screen.height:screen.width;50<=Math.round(c*(e/D.x))?q(b,p()):(c||"a"==b.target.get("tag")||b.target.getParent(".cerabox-close")||b.target.getParent(".cerabox-left")||b.target.getParent(".cerabox-right")||(E.fireEvent("click",b),b.stop(),1!=E.getElement(".cerabox-close").getStyle("opacity")?j():i()),n())}else n()}function n(){B={x:null,y:null},C={x:null,y:null}}function o(){return Math.round(Math.sqrt(Math.pow(C.x-B.x,2)+Math.pow(C.y-B.y,2)))}function p(){var a=B.x-C.x,b=C.y-B.y,c=Math.round(180*Math.atan2(b,a)/Math.PI);return 0>c&&(c=360-Math.abs(c)),c}function q(a,b){b>=315||45>=b?E.getElement(".cerabox-right").fireEvent("click",a):b>=135&&225>=b&&E.getElement(".cerabox-left").fireEvent("click",a),n()}function r(a){a?(document.addEvent("mousewheel",s),document.addEvent("keydown",s)):(document.removeEvent("mousewheel",s),document.removeEvent("keydown",s))}function s(a){a.preventDefault()}var t=!1,u=!1,v=null,w=null,x=!1,y=null,z={x:0,y:0},A=null,B={x:null,y:null},C={x:null,y:null},D={x:0,y:0},E=null,F=new Class({initialize:function(){a.addEvent("domready",function(){h(),this.updateWindow(),document.id("cerabox-loading").addEvent("click",function(a){a.stop(),this.close(!0)}.bind(this)),document.addEvent("keyup",function(a){"esc"==a.key&&this.close(),"input"!=a.target.get("tag")&&"select"!=a.target.get("tag")&&"textarea"!=a.target.get("tag")&&("left"==a.key&&E.getElement(".cerabox-left").fireEvent("click",a),"right"==a.key&&E.getElement(".cerabox-right").fireEvent("click",a))}.bind(this)),E.addEvent("touchstart",k),E.addEvent("touchmove",l),E.addEvent("touchend",m),E.addEvent("touchcancel",n),document.id("cerabox-loading").addEvent("touchmove",function(a){a.stop()})}.bind(this)),a.addEvent("resize",this.updateWindow.bind(this)),a.addEvent("scroll",this.updateWindow.bind(this,"scroll")),a.addEvent("orientationchange",this.updateWindow.bind(this))},updateWindow:function(a){this.setViewport(),!x||null===y||t||"scroll"==a&&!y.options.mobileView||(t=!0,(!1!==y.options.displayOverlay||y.options.mobileView)&&d(),c().addEvent("complete",function(){this.removeEvents("complete"),j(),t=!1}))},close:function(a){t&&!a||u||!y||(t=!a,!0===y.options.preventScrolling&&r(!1),clearInterval(w),clearInterval(v),clearInterval(A),document.id("cerabox-loading").setStyle("display","none"),y.options.mobileView?(document.id("cerabox-background").setStyles({display:"none",width:0,height:0,opacity:0}),E.setStyles({display:"none"}),E.getElement(".cerabox-content").empty().setStyle("opacity",0),E.getElement(".cerabox-left").removeEvents("click").setStyle("display","none"),E.getElement(".cerabox-right").removeEvents("click").setStyle("display","none"),this.hideTitle(),x&&y.options.events.onClose.call(y,y.collection[y.currentItem],y.collection),y=null,x=!1,t=!1):E.set("tween",{duration:50}).tween("opacity",0).get("tween").addEvent("complete",function(){this.removeEvents("complete"),document.id("cerabox-background").set("tween",{duration:50,link:"chain"}).tween("opacity",0).get("tween").addEvent("chainComplete",function(){this.removeEvents("chainComplete"),document.id("cerabox-background").setStyle("display","none"),E.setStyles({display:"none"}),E.getElement(".cerabox-content").empty().setStyle("opacity",0),E.getElement(".cerabox-left").removeEvents("click").setStyle("display","none"),E.getElement(".cerabox-right").removeEvents("click").setStyle("display","none"),G.hideTitle(),x&&y.options.events.onClose.call(y,y.collection[y.currentItem],y.collection),y=null,x=!1,t=!1})}))},setContent:function(a){return E.getElement(".cerabox-content").empty().adopt(a),this},loading:function(a){if(!instanceOf(a,CeraBox))throw"Instance should be an instance of CeraBox";return this.setViewport(),y=a,t=!0,E.getElement(".cerabox-content-protection").setStyle("display","none"),!0===y.options.addContentProtectionLayer&&E.getElement(".cerabox-content-protection").setStyle("display","block"),E.setStyle("cursor","auto").removeEvents("click"),!0===y.options.clickToClose&&E.setStyle("cursor","pointer").addEvent("click",function(a){a.stop(),this.close()}.bind(this)),!0===y.options.preventScrolling&&r(!0),clearInterval(w),clearInterval(v),document.id("cerabox-loading").setStyle("display","none"),v=e.delay(200),E.removeClass("mobile"),y.options.mobileView&&E.addClass("mobile"),this},preLoadElement:function(a){return E.setStyle("display","block"),E.getElement("#cerabox-ajaxPreLoader").empty().adopt(a)},onLoad:function(a,b){return u=!0,clearInterval(w),clearInterval(v),(!1!==y.options.displayOverlay||y.options.mobileView)&&d(),E.getElement("#cerabox-ajaxPreLoader").empty().setStyles({width:"auto",height:"auto"}),z={x:a,y:b},E.getElement(".cerabox-content").set("tween",{duration:y.options.mobileView?0:300}).tween("opacity",x&&E.getElement(".cerabox-content iframe.ceraIframe")?1:0).get("tween")},openWindow:function(a,d){document.id("cerabox-loading").setStyle("display","none"),a=z.x=a||z.x,d=z.y=d||z.y;var e=y.collection[y.currentItem];return j(),x?(c(a,d),void(y.options.mobileView?(E.getElement(".cerabox-content").setStyle("opacity",1),u=!1,t=!1,b(),y.options.events.onChange.call(y,e,y.collection)):E.getElement(".cerabox-content").set("tween",{duration:E.getElement(".cerabox-content iframe.ceraIframe")?0:200}).tween("opacity",1).get("tween").addEvent("complete",function(){this.removeEvents("complete"),u=!1,t=!1,b(),y.options.events.onChange.call(y,e,y.collection)}))):(y.options.mobileView||E.getElement(".cerabox-content").setStyle("opacity",1),y.options.events.onOpen.call(y,e,y.collection),c(a,d).addEvent("complete",function(){this.removeEvents("complete"),y.options.mobileView&&E.getElement(".cerabox-content").setStyle("opacity",1),u=!1,t=!1,b(),y.options.events.onAnimationEnd.call(y,e,y.collection)}),document.body.getElement(e)&&e.blur(),void(x=!0))},displayTitle:function(a,b,c){c>1&&(a=y.options.titleFormat.substitute({number:b,total:c,title:a}));var d=E.getElement(".cerabox-title span");return a?(d.setStyle("display","block").set("text",a),d.set("html",d.get("html").replace(/\n/g,"<br>"))):d.setStyle("display","none"),this},hideTitle:function(){return E.getElement(".cerabox-title span").setStyle("display","none"),this},setViewport:function(){return D={x:a.innerWidth?a.innerWidth:a.getSize().x,y:a.innerHeight?a.innerHeight:a.getSize().y},this},getViewport:function(){return D},getCurrentInstance:function(){return y},getBusy:function(){return t},getWindowOpen:function(){return x},setTimeOuter:function(a){return w=a,this},getSizeElement:function(a,b){var c=0,d=0;if("iframe"==a.get("tag")){E.setStyle("display","block");try{c=a.get("width")?g(a.get("width"),"x"):a.getStyle("width").toInt()>1?g(a.getStyle("width"),"x"):a.contentWindow.document.getScrollSize().x?a.contentWindow.document.getScrollSize().x:.75*D.x}catch(e){c=.75*D.x}try{d=a.get("height")?g(a.get("height"),"y"):a.getStyle("height").toInt()>1?g(a.getStyle("height"),"y"):a.contentWindow.document.getScrollSize().y?a.contentWindow.document.getScrollSize().y:.75*D.y}catch(e){d=.75*D.y}return b||!1!==y.options.fullSize?{width:c,height:d}:(D.y-100<d&&(c+="mac"===Browser.platform?15:17),{width:D.x-50<c?D.x-50:c,height:D.y-100<d?D.y-100:d})}if(c=a.get("width")?g(a.get("width"),"x"):a.getStyle("width")&&"auto"!=a.getStyle("width")?g(a.getStyle("width"),"x"):D.x-50,d=a.get("height")?g(a.get("height"),"y"):a.getStyle("height")&&"auto"!=a.getStyle("height")?g(a.getStyle("height"),"y"):D.y-100,b||!1!==y.options.fullSize)return{width:c,height:d};var f=Math.min(Math.min(D.x-50,c)/c,Math.min(D.y-100,d)/d);return{width:Math.round(f*c),height:Math.round(f*d)}},sizeStringToInt:function(a,b){return g(a,b)}}),G=new F;return G}(window),Element.implement({cerabox:function(a){return this.store("cerabox",new CeraBox(this,a))}}),Elements.implement({cerabox:function(a){if(a&&"null"!=typeOf(a.group)&&a.group!==!0)this.each(function(b){b.store("cerabox",new CeraBox(b,a))});else{var b=new CeraBox(this,a);this.each(function(a){a.store("cerabox",b)})}return this}})}(window);